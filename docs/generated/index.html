<!DOCTYPE html><html class="default" lang="en"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>@ably-labs/models</title><meta name="description" content="Documentation for @ably-labs/models"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script defer src="assets/main.js"></script><script async src="assets/search.js" id="tsd-search-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os"</script><header class="tsd-page-toolbar">
<div class="tsd-toolbar-contents container">
<div class="table-cell" id="tsd-search" data-base=".">
<div class="field"><label for="tsd-search-field" class="tsd-widget tsd-toolbar-icon search no-caption"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><path d="M15.7824 13.833L12.6666 10.7177C12.5259 10.5771 12.3353 10.499 12.1353 10.499H11.6259C12.4884 9.39596 13.001 8.00859 13.001 6.49937C13.001 2.90909 10.0914 0 6.50048 0C2.90959 0 0 2.90909 0 6.49937C0 10.0896 2.90959 12.9987 6.50048 12.9987C8.00996 12.9987 9.39756 12.4863 10.5008 11.6239V12.1332C10.5008 12.3332 10.5789 12.5238 10.7195 12.6644L13.8354 15.7797C14.1292 16.0734 14.6042 16.0734 14.8948 15.7797L15.7793 14.8954C16.0731 14.6017 16.0731 14.1267 15.7824 13.833ZM6.50048 10.499C4.29094 10.499 2.50018 8.71165 2.50018 6.49937C2.50018 4.29021 4.28781 2.49976 6.50048 2.49976C8.71001 2.49976 10.5008 4.28708 10.5008 6.49937C10.5008 8.70852 8.71314 10.499 6.50048 10.499Z" fill="var(--color-text)"></path></svg></label><input type="text" id="tsd-search-field" aria-label="Search"/></div>
<div class="field">
<div id="tsd-toolbar-links"></div></div>
<ul class="results">
<li class="state loading">Preparing search index...</li>
<li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">@ably-labs/models</a></div>
<div class="table-cell" id="tsd-widgets"><a href="#" class="tsd-widget tsd-toolbar-icon menu no-caption" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none"><rect x="1" y="3" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="7" width="14" height="2" fill="var(--color-text)"></rect><rect x="1" y="11" width="14" height="2" fill="var(--color-text)"></rect></svg></a></div></div></header>
<div class="container container-main">
<div class="col-content">
<div class="tsd-page-title">
<h2>@ably-labs/models</h2></div>
<div class="tsd-panel tsd-typography"><a id="md:ably-realtime-data-models-sdk" class="tsd-anchor"></a><h1><a href="#md:ably-realtime-data-models-sdk">Ably Realtime Data Models SDK</a></h1><p align="left">
  <a href="">
    <img src="https://badgen.net/badge/development-status/alpha/yellow?icon=github" alt="Development status"   />
  </a>
  <a href="">
    <img src="https://github.com/ably-labs/models/actions/workflows/dev-ci.yml/badge.svg?branch=main" alt="CI status"   />
  </a>
</p>

<p>The <a href="https://ably.com">Ably</a> Realtime Data Models SDK enables you to build collaborative, stateful applications by defining <em>live, observable data models</em> in your client applications, backed by your database. It allows you to render live changes to data stored in your database in realtime.</p>
<p><img src="/assets/models-diagram.png" alt="Models SDK Diagram" title="Models SDK Diagram"></p>
<p>Try out a <a href="https://models.ably.dev">live demo</a> of a collaborative comment thread application for an example of realtime, stateful collaboration in action.</p>
<p><strong>Bring your own database</strong></p>
<p>The data you render in your frontend application is stored in whatever backend database you choose (or are already using!)</p>
<p><strong>Collaborative by default</strong></p>
<p>Render live updates to the data made concurrently by any number of other users.</p>
<p><strong>Optimistic updates</strong></p>
<p>Create a very fast &amp; snappy user experience by rendering changes instantly without waiting for the network round trip or for your mutations to be committed to the database. The Models SDK automatically confirms changes in the background, handles rollbacks, and surfaces errors or conflicts to your application.</p>
<p><strong>Backed by Ably</strong></p>
<p>Leverages Ablyâ€™s low-latency, global message distribution network to keep a large number of clients across multiple regions up-to-date with the latest database state.</p>
<a id="md:status" class="tsd-anchor"></a><h2><a href="#md:status">Status</a></h2><p>The Realtime Data Models SDK is currently under development. If you are interested in being an early adopter and providing feedback then you can <a href="https://go.ably.com/models-early-access">sign up</a> for early access and are welcome to <a href="https://go.ably.com/models-feedback">provide us with feedback</a>.</p>
<a id="md:quickstart" class="tsd-anchor"></a><h2><a href="#md:quickstart">Quickstart</a></h2><p>Get started quickly using this section, or take a look at:</p>
<ul>
<li>Detailed <a href="/docs/usage.md">usage instructions</a></li>
<li><a href="/docs/generated/index.html">API docs</a></li>
<li>Explore the <a href="/examples">examples</a></li>
</ul>
<a id="md:prerequisites" class="tsd-anchor"></a><h3><a href="#md:prerequisites">Prerequisites</a></h3><p>To begin, you will need the following:</p>
<ul>
<li>An Ably account. You can <a href="https://ably.com/signup">sign up</a> for free.</li>
<li>An Ably API key. You can create API keys in an app within your <a href="https://ably.com/dashboard">Ably account</a>.<ul>
<li>The API key needs the following <a href="https://ably.com/docs/auth/capabilities">capabilities</a>: <code>publish</code>, <code>subscribe</code>.</li>
</ul>
</li>
</ul>
<p>You can use <a href="https://ably.com/docs/auth/basic">basic authentication</a> for testing purposes, however it is strongly recommended that you use <a href="https://ably.com/docs/auth/token">token authentication</a> in production environments.</p>
<a id="md:authenticate-and-instantiate" class="tsd-anchor"></a><h3><a href="#md:authenticate-and-instantiate">Authenticate and instantiate</a></h3><p>Install the Realtime Data Models SDK and the Ably JavaScript SDK:</p>
<pre><code class="language-sh"><span class="hl-0">npm</span><span class="hl-1"> </span><span class="hl-2">install</span><span class="hl-1"> </span><span class="hl-2">ably</span><span class="hl-1"> </span><span class="hl-2">@ably-labs/models</span>
</code><button>Copy</button></pre>
<p>To instantiate the Models SDK, create an <a href="https://ably.com/docs/getting-started/setup">Ably client</a> and pass it into the Models constructor:</p>
<pre><code class="language-ts"><span class="hl-3">import</span><span class="hl-1"> </span><span class="hl-4">Models</span><span class="hl-1"> </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;@ably-labs/models&#39;</span><span class="hl-1">;</span><br/><span class="hl-3">import</span><span class="hl-1"> { </span><span class="hl-4">Realtime</span><span class="hl-1"> } </span><span class="hl-3">from</span><span class="hl-1"> </span><span class="hl-2">&#39;ably/promises&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">ably</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-4">Realtime</span><span class="hl-1">.</span><span class="hl-0">Promise</span><span class="hl-1">({ </span><span class="hl-4">key:</span><span class="hl-1"> </span><span class="hl-2">&quot;&lt;ABLY_API_KEY&gt;&quot;</span><span class="hl-1"> });</span><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">models</span><span class="hl-1"> = </span><span class="hl-5">new</span><span class="hl-1"> </span><span class="hl-0">Models</span><span class="hl-1">({ </span><span class="hl-4">ably</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<a id="md:concepts" class="tsd-anchor"></a><h3><a href="#md:concepts">Concepts</a></h3><a id="md:model" class="tsd-anchor"></a><h4><a href="#md:model">Model</a></h4><p>A <code>Model</code> is a single instance of a live, observable data model backed by your database.</p>
<p>You can represent your data model in your frontend application however you like; it is completely decoupled from the way you represent the data in your database!</p>
<p>To instantiate a <code>Model</code>, give it a unique name to identify the model in your application. If a model with that name does not yet exist, it will be created; otherwise, the existing instance will be returned.</p>
<pre><code class="language-ts"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-7">Post</span><span class="hl-1"> = {</span><br/><span class="hl-1">  </span><span class="hl-4">id</span><span class="hl-1">: </span><span class="hl-7">number</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">text</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">;</span><br/><span class="hl-1">  </span><span class="hl-4">comments</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">[];</span><br/><span class="hl-1">};</span><br/><br/><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">model</span><span class="hl-1"> = </span><span class="hl-4">models</span><span class="hl-1">.</span><span class="hl-0">Model</span><span class="hl-1">&lt;</span><span class="hl-7">Post</span><span class="hl-1">, </span><span class="hl-7">Mutations</span><span class="hl-1">&gt;(</span><span class="hl-2">&#39;post&#39;</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>Note that we pass in the shape of our data model (<code>Post</code>) as a type parameter.</p>
<blockquote>
<p>In addition, we pass in a type parameter that defines the set of available <a href="#mutation-functions"><em>mutations</em></a> on the data model, described below.</p>
</blockquote>
<p>Once your model is instantiated, we need to make some <em>registrations</em> which link up the model to your application code:</p>
<pre><code class="language-ts"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">$register</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">$sync:</span><span class="hl-1"> </span><span class="hl-8">/* ... */</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">$update:</span><span class="hl-1"> </span><span class="hl-8">/* ... */</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">$mutate:</span><span class="hl-1"> </span><span class="hl-8">/* ... */</span><span class="hl-1">,</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>Let&#39;s take a look at each of these registrations in turn.</p>
<a id="md:sync-function" class="tsd-anchor"></a><h5><a href="#md:sync-function">Sync Function</a></h5><blockquote>
<p>A <em>sync function</em> tells your model how to initialise with the latest data.</p>
</blockquote>
<p>To initialise the data in your model, we need to provide it with a <em>sync function</em>. The sync function has the following type:</p>
<pre><code class="language-ts"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-7">SyncFunc</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt; = () </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt;;</span>
</code><button>Copy</button></pre>
<p>i.e it can be any function that returns a promise with the latest state of your data model. Typically, you would implement this as a function which retrieves the model state from your backend over the network. For example, we might have a REST HTTP API endpoint which returns the data for our post:</p>
<pre><code class="language-ts"><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">sync</span><span class="hl-1">() {</span><br/><span class="hl-1">    </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">&#39;/api/post&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">$register</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">$sync:</span><span class="hl-1"> </span><span class="hl-4">sync</span><span class="hl-1">,</span><br/><span class="hl-1">  </span><span class="hl-8">/* other registrations */</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>The model will invoke this function at the start of its lifecycle to initialise your model state. Additionally, this function will be invoked if the model needs to re-synchronise at any point, for example after an extended period of network disconnectivity.</p>
<a id="md:update-functions" class="tsd-anchor"></a><h5><a href="#md:update-functions">Update Functions</a></h5><blockquote>
<p><em>Update functions</em> tell your model how to calculate the next version of the data when a mutation event occurs.</p>
</blockquote>
<p>When changes occur to your data model in your backend, your backend is expected to emit <em>events</em> which describe the mutation that occurred. The Models SDK will consume these events and apply them to its local copy of the model state to produce the next updated version. The way the next state is calculated is expressed as an <em>update function</em>, which has the following type:</p>
<pre><code class="language-ts"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-7">UpdateFunc</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt; = (</span><span class="hl-4">state</span><span class="hl-1">: </span><span class="hl-7">T</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">: </span><span class="hl-7">OptimisticEvent</span><span class="hl-1"> | </span><span class="hl-7">ConfirmedEvent</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1">&gt;;</span>
</code><button>Copy</button></pre>
<p>i.e. it is a function that accepts the previous model state and the event and returns the next model state.</p>
<blockquote>
<p>An event can be either <em>optimistic</em> or <em>confirmed</em>. Events that come from your backend are always treated as <em>confirmed</em> events as they describe a mutation to the data which has been accepted by your backend. Soon, we will see how the Models SDK can also emit local <em>optimistic</em> events which describe mutations that have happened locally but have not yet been confirmed by your backend.</p>
</blockquote>
<p>Confirmed events are emitted from your backend over Ably <em><a href="https://ably.com/docs/channels">channels</a></em>. A model can consume events from any number of Ably channels.</p>
<blockquote>
<p><strong>Note</strong>
Ably&#39;s <a href="https://github.com/ably-labs/adbc">Database Connector</a> makes it easy to emit change events over Ably transactionally with mutations to your data in your database.</p>
</blockquote>
<p>An update function is associated with a <em>channel name</em> and an <em>event name</em>; the model will invoke the update function whenever it receives an event with that name on the associated channel.</p>
<p>For example, we might define an update function which runs when we get an <code>update</code> event on the <code>posts</code> channel, where the payload is the new value of the post&#39;s <code>text</code> field.</p>
<pre><code class="language-ts"><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">onPostUpdated</span><span class="hl-1">(</span><span class="hl-4">state</span><span class="hl-1">, </span><span class="hl-4">event</span><span class="hl-1">) {</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> {</span><br/><span class="hl-1">        ...</span><span class="hl-4">state</span><span class="hl-1">,</span><br/><span class="hl-1">        </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-4">event</span><span class="hl-1">.</span><span class="hl-4">data</span><span class="hl-1">, </span><span class="hl-8">// replace the previous post text field with the new value</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">$register</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-8">// update functions are registered on the model using a</span><br/><span class="hl-1">    </span><span class="hl-8">// mapping of channel_name -&gt; event_name -&gt; update_function</span><br/><span class="hl-1">    </span><span class="hl-4">$update:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-2">&#39;posts&#39;</span><span class="hl-4">:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-2">&#39;update&#39;</span><span class="hl-4">:</span><span class="hl-1"> </span><span class="hl-4">onPostUpdated</span><span class="hl-1">,</span><br/><span class="hl-1">        },</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  </span><span class="hl-8">/* other registrations */</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<a id="md:mutation-functions" class="tsd-anchor"></a><h5><a href="#md:mutation-functions">Mutation Functions</a></h5><blockquote>
<p><em>Mutation functions</em> allows you to make changes to your data in your backend and tells your model what changes to expect.</p>
</blockquote>
<p>In order to make changes to your data, you can register a set of <em>mutations</em> on the data model. A mutation has the following type:</p>
<pre><code class="language-ts"><span class="hl-5">type</span><span class="hl-1"> </span><span class="hl-7">MutationFunc</span><span class="hl-1">&lt;</span><span class="hl-7">T</span><span class="hl-1"> </span><span class="hl-5">extends</span><span class="hl-1"> </span><span class="hl-7">any</span><span class="hl-1">[] = </span><span class="hl-7">any</span><span class="hl-1">[], </span><span class="hl-7">R</span><span class="hl-1"> = </span><span class="hl-7">any</span><span class="hl-1">&gt; = (...</span><span class="hl-4">args</span><span class="hl-1">: </span><span class="hl-7">T</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> </span><span class="hl-7">Promise</span><span class="hl-1">&lt;</span><span class="hl-7">R</span><span class="hl-1">&gt;</span>
</code><button>Copy</button></pre>
<p>i.e. it is a simple function which accepts any input arguments you like and returns a promise of a given type. Typically, you would implement this as a function which updates the model state in your backend over the network. For example, we might have a REST HTTP API endpoint which updates the data for our post:</p>
<pre><code class="language-ts"><span class="hl-3">export</span><span class="hl-1"> </span><span class="hl-5">async</span><span class="hl-1"> </span><span class="hl-5">function</span><span class="hl-1"> </span><span class="hl-0">updatePost</span><span class="hl-1">(</span><span class="hl-4">content</span><span class="hl-1">: </span><span class="hl-7">string</span><span class="hl-1">) {</span><br/><span class="hl-1">  </span><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-0">fetch</span><span class="hl-1">(</span><span class="hl-2">`/api/post`</span><span class="hl-1">, {</span><br/><span class="hl-1">    </span><span class="hl-4">method:</span><span class="hl-1"> </span><span class="hl-2">&#39;PUT&#39;</span><span class="hl-1">,</span><br/><span class="hl-1">    </span><span class="hl-4">body:</span><span class="hl-1"> </span><span class="hl-6">JSON</span><span class="hl-1">.</span><span class="hl-0">stringify</span><span class="hl-1">({ </span><span class="hl-4">content</span><span class="hl-1"> }),</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">    </span><span class="hl-3">return</span><span class="hl-1"> </span><span class="hl-4">result</span><span class="hl-1">.</span><span class="hl-0">json</span><span class="hl-1">();</span><br/><span class="hl-1">}</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">$register</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">$mutate:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">updatePost</span><span class="hl-1">,</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  </span><span class="hl-8">/* other registrations */</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>The backend API endpoint would then update the post data in the database and emit a confirmation event, which would be received and processed by our <code>onPostUpdated</code> update function described <a href="#update-functions">above</a>.</p>
<p>It is possible to configure options on each mutation, for example to set a specific timeout within which the model will expect the mutation to be confirmed:</p>
<pre><code class="language-ts"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">$register</span><span class="hl-1">({</span><br/><span class="hl-1">    </span><span class="hl-4">$mutate:</span><span class="hl-1"> {</span><br/><span class="hl-1">        </span><span class="hl-4">updatePost:</span><span class="hl-1"> {</span><br/><span class="hl-1">            </span><span class="hl-4">func:</span><span class="hl-1"> </span><span class="hl-4">updatePost</span><span class="hl-1">,</span><br/><span class="hl-1">            </span><span class="hl-4">options:</span><span class="hl-1"> { </span><span class="hl-4">timeout:</span><span class="hl-1"> </span><span class="hl-9">5000</span><span class="hl-1"> },</span><br/><span class="hl-1">        }</span><br/><span class="hl-1">    },</span><br/><span class="hl-1">  </span><span class="hl-8">/* other registrations */</span><br/><span class="hl-1">});</span>
</code><button>Copy</button></pre>
<p>You can now invoke the registered mutation using the <code>mutations</code> handle on the model:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> </span><span class="hl-6">result</span><span class="hl-1"> = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-4">mutations</span><span class="hl-1">.</span><span class="hl-0">updatePost</span><span class="hl-1">(</span><span class="hl-2">&#39;new value&#39;</span><span class="hl-1">);</span>
</code><button>Copy</button></pre>
<p>The Models SDK supports <em>optimistic updates</em> which allows you to render the latest changes to your data model before they have been confirmed by the backend. This makes for a really quick and snappy user experience where all updated feel instantaneous! To achieve this, when you invoke a mutation you can specify a set of <em>optimistic events</em> which will be applied to your data model immediately:</p>
<pre><code class="language-ts"><span class="hl-5">const</span><span class="hl-1"> [</span><span class="hl-6">result</span><span class="hl-1">, </span><span class="hl-6">updated</span><span class="hl-1">, </span><span class="hl-6">confirmed</span><span class="hl-1">] = </span><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-4">mutations</span><span class="hl-1">.</span><span class="hl-4">updatePost</span><span class="hl-1">.</span><span class="hl-0">$expect</span><span class="hl-1">([</span><br/><span class="hl-1">    { </span><span class="hl-4">channel:</span><span class="hl-1"> </span><span class="hl-2">&#39;post&#39;</span><span class="hl-1">, </span><span class="hl-4">name:</span><span class="hl-1"> </span><span class="hl-2">&#39;update&#39;</span><span class="hl-1">, </span><span class="hl-4">text:</span><span class="hl-1"> </span><span class="hl-2">&#39;new value&#39;</span><span class="hl-1"> },	</span><span class="hl-8">// optimistic event</span><br/><span class="hl-1">])(</span><span class="hl-2">&#39;new value&#39;</span><span class="hl-1">);</span><br/><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">updated</span><span class="hl-1">;</span><br/><span class="hl-8">// optimistic update applied!</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">confirmed</span><span class="hl-1">;</span><br/><span class="hl-8">// optimistic update was confirmed by the backend!</span>
</code><button>Copy</button></pre>
<p>When a mutation is invoked in this way, the mutation returns not only the result from calling the mutation function but also two additional promises that will resolve when the optimistic update is applied and when it is ultimately confirmed by the backend!</p>
<a id="md:subscriptions" class="tsd-anchor"></a><h5><a href="#md:subscriptions">Subscriptions</a></h5><p>Once our registrations are complete, we can now subscribe to our data model to get updated whenever the data changes in realtime:</p>
<pre><code class="language-ts"><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">post</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-3">if</span><span class="hl-1"> (</span><span class="hl-4">err</span><span class="hl-1">) {</span><br/><span class="hl-1">        </span><span class="hl-3">throw</span><span class="hl-1"> </span><span class="hl-4">err</span><span class="hl-1">;</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">    </span><span class="hl-4">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;post updated:&#39;</span><span class="hl-1">, </span><span class="hl-4">post</span><span class="hl-1">);</span><br/><span class="hl-1">})</span>
</code><button>Copy</button></pre>
<p>By default this is an <em>optimistic</em> subscription, so the subscription callback will be invoked whenever the optimistic state of the model changes (as well as when confirmed changes are made).</p>
<p>If we only want to subscribe to confirmed changes, we can provide some options when we subscribe:</p>
<pre><code class="language-ts"><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">subscribe</span><span class="hl-1">((</span><span class="hl-4">err</span><span class="hl-1">, </span><span class="hl-4">post</span><span class="hl-1">) </span><span class="hl-5">=&gt;</span><span class="hl-1"> { </span><span class="hl-8">/* ... */</span><span class="hl-1"> }, { </span><span class="hl-4">optimistic:</span><span class="hl-1"> </span><span class="hl-5">false</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
<a id="md:model-lifecycle" class="tsd-anchor"></a><h5><a href="#md:model-lifecycle">Model Lifecycle</a></h5><p>There may be cases where we want to pause or resume a model. We can do this using the methods available on the model instance:</p>
<pre><code class="language-ts"><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">$pause</span><span class="hl-1">();</span><br/><span class="hl-8">// model paused: new events will not be processed and subscription callbacks will no longer be invoked</span><br/><span class="hl-3">await</span><span class="hl-1"> </span><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">$resume</span><span class="hl-1">();</span><br/><span class="hl-8">// processing of events has resumed and new changes will be made available to subscribers</span>
</code><button>Copy</button></pre>
<p>It is also possible to hook into the model lifecycle by listening directly for model state change events on the model instance (which itself is an event emitter):</p>
<pre><code class="language-ts"><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;paused&#39;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> { </span><span class="hl-8">/* model paused*/</span><span class="hl-1"> });</span><br/><span class="hl-4">model</span><span class="hl-1">.</span><span class="hl-0">on</span><span class="hl-1">(</span><span class="hl-2">&#39;ready&#39;</span><span class="hl-1">, () </span><span class="hl-5">=&gt;</span><span class="hl-1"> { </span><span class="hl-8">/* model resumed */</span><span class="hl-1"> });</span>
</code><button>Copy</button></pre>
</div></div>
<div class="col-sidebar">
<div class="page-menu">
<div class="tsd-navigation settings">
<details class="tsd-index-accordion"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><path d="M4.93896 8.531L12 15.591L19.061 8.531L16.939 6.409L12 11.349L7.06098 6.409L4.93896 8.531Z" fill="var(--color-text)" id="icon-chevronDown"></path></svg>Settings</h3></summary>
<div class="tsd-accordion-details">
<div class="tsd-filter-visibility">
<h4 class="uppercase">Member Visibility</h4><form>
<ul id="tsd-filter-options">
<li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li></ul></form></div>
<div class="tsd-theme-toggle">
<h4 class="uppercase">Theme</h4><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div>
<details open class="tsd-index-accordion tsd-page-navigation"><summary class="tsd-accordion-summary">
<h3><svg width="20" height="20" viewBox="0 0 24 24" fill="none"><use href="#icon-chevronDown"></use></svg>On This Page</h3></summary>
<div class="tsd-accordion-details">
<ul>
<li>
<ul>
<li><a href="#md:ably-realtime-data-models-sdk"><span>Ably <wbr/>Realtime <wbr/>Data <wbr/>Models SDK</span></a></li>
<li>
<ul>
<li><a href="#md:status"><span>Status</span></a></li>
<li><a href="#md:quickstart"><span>Quickstart</span></a></li>
<li>
<ul>
<li><a href="#md:prerequisites"><span>Prerequisites</span></a></li>
<li><a href="#md:authenticate-and-instantiate"><span>Authenticate and instantiate</span></a></li>
<li><a href="#md:concepts"><span>Concepts</span></a></li>
<li>
<ul>
<li><a href="#md:model"><span>Model</span></a></li>
<li>
<ul>
<li><a href="#md:sync-function"><span>Sync <wbr/>Function</span></a></li>
<li><a href="#md:update-functions"><span>Update <wbr/>Functions</span></a></li>
<li><a href="#md:mutation-functions"><span>Mutation <wbr/>Functions</span></a></li>
<li><a href="#md:subscriptions"><span>Subscriptions</span></a></li>
<li><a href="#md:model-lifecycle"><span>Model <wbr/>Lifecycle</span></a></li></ul></li></ul></li></ul></li></ul></li></ul></li></ul></div></details></div>
<div class="site-menu">
<nav class="tsd-navigation"><a href="index.html" class="current"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><g id="icon-4"><rect fill="var(--color-icon-background)" stroke="var(--color-ts-namespace)" stroke-width="1.5" x="1" y="1" width="22" height="22" rx="6"></rect><path d="M9.33 16V7.24H10.77L13.446 14.74C13.43 14.54 13.41 14.296 13.386 14.008C13.37 13.712 13.354 13.404 13.338 13.084C13.33 12.756 13.326 12.448 13.326 12.16V7.24H14.37V16H12.93L10.266 8.5C10.282 8.692 10.298 8.936 10.314 9.232C10.33 9.52 10.342 9.828 10.35 10.156C10.366 10.476 10.374 10.784 10.374 11.08V16H9.33Z" fill="var(--color-text)"></path></g></svg><span>@ably-<wbr/>labs/models</span></a>
<ul class="tsd-small-nested-navigation">
<li><a href="modules/index.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>index</span></a></li>
<li><a href="modules/types_callbacks.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types/callbacks</span></a></li>
<li><a href="modules/types_model.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types/model</span></a></li>
<li><a href="modules/types_mutations.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types/mutations</span></a></li>
<li><a href="modules/types_updates.html"><svg class="tsd-kind-icon" viewBox="0 0 24 24"><use href="#icon-4"></use></svg><span>types/updates</span></a></li></ul></nav></div></div></div>
<div class="tsd-generator">
<p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div>
<div class="overlay"></div></body></html>